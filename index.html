<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container py-4">
        <header class="text-center mb-4">
            <h1 class="display-4 fw-bold text-primary">üé® Meme Generator</h1>
            <p class="lead">Create hilarious memes in seconds!</p>
        </header>

        <div class="row">
            <!-- Left Panel - Controls -->
            <div class="col-md-4">
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Templates</h5>
                        
                        <!-- Template Search -->
                        <div class="mb-3">
                            <input type="text" id="templateSearch" class="form-control" placeholder="Search templates...">
                        </div>
                        
                        <!-- Template Gallery -->
                        <div class="template-gallery mb-4">
                            <h6>Popular Templates</h6>
                            <div class="template-grid" id="templateGrid">
                                <!-- Templates loaded by JS -->
                            </div>
                        </div>
                        
                        <!-- Upload Section -->
                        <div class="upload-section mb-4">
                            <h6>Upload Your Own</h6>
                            <input type="file" id="uploadTemplate" class="form-control mb-2" accept="image/*">
                            <button onclick="addUserTemplate()" class="btn btn-outline-primary w-100">Add Template</button>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">Text Controls</h5>
                        
                        <!-- Text Elements List -->
                        <div class="text-elements-panel mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6>Text Elements</h6>
                                <button onclick="addTextElement()" class="btn btn-sm btn-primary">+ Add Text</button>
                            </div>
                            <div id="textElementsList">
                                <!-- Text elements will be added here -->
                            </div>
                        </div>

                        <!-- Text Properties -->
                        <div class="text-properties">
                            <div class="mb-3">
                                <label class="form-label">Text Content</label>
                                <textarea id="textContent" class="form-control" rows="2" placeholder="Enter your text"></textarea>
                            </div>
                            
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label class="form-label">Text Size</label>
                                    <input type="range" id="textSize" class="form-range" min="10" max="80" value="36">
                                    <div class="text-center"><small id="textSizeValue">36px</small></div>
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Stroke Width</label>
                                    <input type="range" id="strokeWidth" class="form-range" min="0" max="8" value="3">
                                    <div class="text-center"><small id="strokeWidthValue">3px</small></div>
                                </div>
                            </div>
                            
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label class="form-label">Text Color</label>
                                    <input type="color" id="textColor" class="form-control form-control-color" value="#ffffff">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Stroke Color</label>
                                    <input type="color" id="strokeColor" class="form-control form-control-color" value="#000000">
                                </div>
                            </div>
                            
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label class="form-label">Font Family</label>
                                    <select id="fontFamily" class="form-select">
                                        <option value="Impact">Impact</option>
                                        <option value="Arial Black">Arial Black</option>
                                        <option value="Comic Sans MS">Comic Sans</option>
                                        <option value="Verdana">Verdana</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Text Alignment</label>
                                    <select id="textAlign" class="form-select">
                                        <option value="center">Center</option>
                                        <option value="left">Left</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button onclick="drawMeme()" class="btn btn-primary">Update Meme</button>
                            <button onclick="downloadMeme()" class="btn btn-success">Download Meme</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Canvas -->
            <div class="col-md-8">
                <div class="card shadow-sm">
                    <div class="card-body text-center">
                        <div class="canvas-container position-relative">
                            <canvas id="meme-canvas"></canvas>
                            <div class="canvas-overlay" id="canvasOverlay">
                                <!-- Text elements will be positioned here -->
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">Drag text boxes to reposition them</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Meme Generator Application
        const canvas = document.getElementById('meme-canvas');
        const ctx = canvas.getContext('2d');
        const canvasOverlay = document.getElementById('canvasOverlay');

        // Current state
        let currentImage = null;
        let textElements = [];
        let activeTextElement = null;
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        // Default text properties
        const defaultTextProps = {
            text: 'Your Text Here',
            x: 50,
            y: 20,
            size: 36,
            color: '#ffffff',
            strokeColor: '#000000',
            strokeWidth: 3,
            font: 'Impact',
            align: 'center'
        };

        // Meme templates
        const memeTemplates = [
            { name: "Drake", url: "https://i.imgflip.com/30b1gx.jpg" },
            { name: "Doge", url: "https://i.imgflip.com/4t0m5.jpg" },
            { name: "Two Buttons", url: "https://i.imgflip.com/1g8my4.jpg" },
            { name: "Distracted Boyfriend", url: "https://i.imgflip.com/1ur9b0.jpg" },
            { name: "Change My Mind", url: "https://i.imgflip.com/24y43o.jpg" },
            { name: "Woman Yelling at Cat", url: "https://i.imgflip.com/345v97.jpg" },
            { name: "Left Exit 12", url: "https://i.imgflip.com/22bdq6.jpg" },
            { name: "Running Away Balloon", url: "https://i.imgflip.com/261o3j.jpg" },
            { name: "Winnie the Pooh", url: "https://i.imgflip.com/2ybua0.jpg" },
            { name: "Mocking Spongebob", url: "https://i.imgflip.com/1otk96.jpg" }
        ];

        // User templates
        let userTemplates = JSON.parse(localStorage.getItem('userTemplates')) || [];

        // Initialize the application
        function init() {
            initializeTemplateGallery();
            setupEventListeners();
            loadImage(memeTemplates[0].url);
            addTextElement();
        }

        // Initialize template gallery
        function initializeTemplateGallery() {
            const templateGrid = document.getElementById('templateGrid');
            
            // Load default templates
            loadTemplatesToGrid(memeTemplates, templateGrid);
            
            // Setup search functionality
            document.getElementById('templateSearch').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filteredTemplates = memeTemplates.filter(template => 
                    template.name.toLowerCase().includes(searchTerm)
                );
                loadTemplatesToGrid(filteredTemplates, templateGrid);
            });
        }

        // Load templates to grid
        function loadTemplatesToGrid(templates, container) {
            container.innerHTML = '';
            
            templates.forEach(template => {
                const templateItem = document.createElement('div');
                templateItem.className = 'template-item';
                templateItem.innerHTML = `
                    <img src="${template.url}" alt="${template.name}" class="template-img">
                    <p class="template-name">${template.name}</p>
                `;
                
                templateItem.addEventListener('click', () => {
                    // Remove active class from all items
                    document.querySelectorAll('.template-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    // Add active class to clicked item
                    templateItem.classList.add('active');
                    // Load the template
                    loadImage(template.url);
                });
                
                container.appendChild(templateItem);
            });
            
            // Activate first template
            if (templates.length > 0) {
                const firstItem = container.querySelector('.template-item');
                if (firstItem) {
                    firstItem.classList.add('active');
                }
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Text property controls
            document.getElementById('textContent').addEventListener('input', function() {
                if (activeTextElement) {
                    activeTextElement.text = this.value;
                    updateTextElement(activeTextElement.id);
                    drawMeme();
                }
            });

            document.getElementById('textSize').addEventListener('input', function() {
                document.getElementById('textSizeValue').textContent = this.value + 'px';
                if (activeTextElement) {
                    activeTextElement.size = parseInt(this.value);
                    updateTextElement(activeTextElement.id);
                    drawMeme();
                }
            });

            document.getElementById('strokeWidth').addEventListener('input', function() {
                document.getElementById('strokeWidthValue').textContent = this.value + 'px';
                if (activeTextElement) {
                    activeTextElement.strokeWidth = parseInt(this.value);
                    updateTextElement(activeTextElement.id);
                    drawMeme();
                }
            });

            document.getElementById('textColor').addEventListener('input', function() {
                if (activeTextElement) {
                    activeTextElement.color = this.value;
                    updateTextElement(activeTextElement.id);
                    drawMeme();
                }
            });

            document.getElementById('strokeColor').addEventListener('input', function() {
                if (activeTextElement) {
                    activeTextElement.strokeColor = this.value;
                    updateTextElement(activeTextElement.id);
                    drawMeme();
                }
            });

            document.getElementById('fontFamily').addEventListener('change', function() {
                if (activeTextElement) {
                    activeTextElement.font = this.value;
                    updateTextElement(activeTextElement.id);
                    drawMeme();
                }
            });

            document.getElementById('textAlign').addEventListener('change', function() {
                if (activeTextElement) {
                    activeTextElement.align = this.value;
                    updateTextElement(activeTextElement.id);
                    drawMeme();
                }
            });
        }

        // Load image to canvas
        function loadImage(url) {
            currentImage = new Image();
            currentImage.crossOrigin = "anonymous";
            currentImage.src = url;
            
            currentImage.onload = function() {
                // Set canvas dimensions to match image
                const maxWidth = 600;
                const scale = Math.min(maxWidth / currentImage.width, 1);
                
                canvas.width = currentImage.width * scale;
                canvas.height = currentImage.height * scale;
                
                // Clear existing text elements
                textElements = [];
                activeTextElement = null;
                document.getElementById('textElementsList').innerHTML = '';
                canvasOverlay.innerHTML = '';
                
                // Add default text elements
                addTextElement('TOP TEXT', 50, 15);
                addTextElement('BOTTOM TEXT', 50, 85);
                
                drawMeme();
            };
            
            currentImage.onerror = function() {
                console.error('Failed to load image:', url);
                alert('Failed to load template image. Please try another one.');
            };
        }

        // Add text element
        function addTextElement(text = defaultTextProps.text, x = defaultTextProps.x, y = defaultTextProps.y) {
            const id = 'text_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            const textElement = {
                id: id,
                text: text,
                x: x,
                y: y,
                size: defaultTextProps.size,
                color: defaultTextProps.color,
                strokeColor: defaultTextProps.strokeColor,
                strokeWidth: defaultTextProps.strokeWidth,
                font: defaultTextProps.font,
                align: defaultTextProps.align
            };
            
            textElements.push(textElement);
            createTextElementDOM(textElement);
            setActiveTextElement(id);
            drawMeme();
        }

        // Create text element DOM
        function createTextElementDOM(textElement) {
            const textElementsList = document.getElementById('textElementsList');
            
            // Create list item
            const listItem = document.createElement('div');
            listItem.className = 'text-element-item';
            listItem.dataset.id = textElement.id;
            listItem.innerHTML = `
                <div class="text-element-preview">${textElement.text}</div>
                <div class="text-element-actions">
                    <button class="text-element-action edit" onclick="editTextElement('${textElement.id}')">‚úèÔ∏è</button>
                    <button class="text-element-action delete" onclick="deleteTextElement('${textElement.id}')">üóëÔ∏è</button>
                </div>
            `;
            
            listItem.addEventListener('click', (e) => {
                if (!e.target.classList.contains('text-element-action')) {
                    setActiveTextElement(textElement.id);
                }
            });
            
            textElementsList.appendChild(listItem);
            
            // Create visual text box
            createVisualTextBox(textElement);
        }

        // Create visual text box
        function createVisualTextBox(textElement) {
            const textBox = document.createElement('div');
            textBox.className = 'text-box';
            textBox.id = 'visual_' + textElement.id;
            textBox.dataset.id = textElement.id;
            textBox.textContent = textElement.text;
            
            // Position the text box
            updateTextBoxPosition(textBox, textElement);
            
            // Style the text box
            updateTextBoxStyle(textBox, textElement);
            
            // Add delete button
            const deleteBtn = document.createElement('div');
            deleteBtn.className = 'text-box-handle delete';
            deleteBtn.innerHTML = '√ó';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                deleteTextElement(textElement.id);
            };
            textBox.appendChild(deleteBtn);
            
            // Add drag functionality
            setupTextBoxDrag(textBox);
            
            canvasOverlay.appendChild(textBox);
        }

        // Update text box position
        function updateTextBoxPosition(textBox, textElement) {
            const canvasRect = canvas.getBoundingClientRect();
            const x = (textElement.x / 100) * canvasRect.width;
            const y = (textElement.y / 100) * canvasRect.height;
            
            textBox.style.left = x + 'px';
            textBox.style.top = y + 'px';
            textBox.style.transform = 'translate(-50%, -50%)';
        }

        // Update text box style
        function updateTextBoxStyle(textBox, textElement) {
            textBox.style.fontSize = textElement.size + 'px';
            textBox.style.color = textElement.color;
            textBox.style.fontFamily = textElement.font;
            textBox.style.textAlign = textElement.align;
            textBox.style.textShadow = `
                ${textElement.strokeWidth}px ${textElement.strokeWidth}px 0 ${textElement.strokeColor},
                -${textElement.strokeWidth}px -${textElement.strokeWidth}px 0 ${textElement.strokeColor},
                ${textElement.strokeWidth}px -${textElement.strokeWidth}px 0 ${textElement.strokeColor},
                -${textElement.strokeWidth}px ${textElement.strokeWidth}px 0 ${textElement.strokeColor}
            `;
        }

        // Setup text box drag functionality
        function setupTextBoxDrag(textBox) {
            textBox.addEventListener('mousedown', startDrag);
            textBox.addEventListener('touchstart', startDragTouch, { passive: false });
            
            function startDrag(e) {
                isDragging = true;
                const textElement = textElements.find(te => te.id === textBox.dataset.id);
                if (textElement) {
                    setActiveTextElement(textElement.id);
                }
                
                const rect = textBox.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                
                dragOffsetX = e.clientX - rect.left;
                dragOffsetY = e.clientY - rect.top;
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                
                e.preventDefault();
            }
            
            function startDragTouch(e) {
                isDragging = true;
                const textElement = textElements.find(te => te.id === textBox.dataset.id);
                if (textElement) {
                    setActiveTextElement(textElement.id);
                }
                
                const rect = textBox.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                
                dragOffsetX = e.touches[0].clientX - rect.left;
                dragOffsetY = e.touches[0].clientY - rect.top;
                
                document.addEventListener('touchmove', dragTouch, { passive: false });
                document.addEventListener('touchend', stopDrag);
                
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                const canvasRect = canvas.getBoundingClientRect();
                const x = ((e.clientX - dragOffsetX - canvasRect.left) / canvasRect.width) * 100;
                const y = ((e.clientY - dragOffsetY - canvasRect.top) / canvasRect.height) * 100;
                
                updateTextElementPosition(textBox.dataset.id, x, y);
            }
            
            function dragTouch(e) {
                if (!isDragging) return;
                e.preventDefault();
                
                const canvasRect = canvas.getBoundingClientRect();
                const x = ((e.touches[0].clientX - dragOffsetX - canvasRect.left) / canvasRect.width) * 100;
                const y = ((e.touches[0].clientY - dragOffsetY - canvasRect.top) / canvasRect.height) * 100;
                
                updateTextElementPosition(textBox.dataset.id, x, y);
            }
            
            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('touchmove', dragTouch);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchend', stopDrag);
                drawMeme();
            }
        }

        // Update text element position
        function updateTextElementPosition(id, x, y) {
            const textElement = textElements.find(te => te.id === id);
            if (textElement) {
                textElement.x = Math.max(0, Math.min(100, x));
                textElement.y = Math.max(0, Math.min(100, y));
                
                const textBox = document.getElementById('visual_' + id);
                if (textBox) {
                    updateTextBoxPosition(textBox, textElement);
                }
            }
        }

        // Set active text element
        function setActiveTextElement(id) {
            // Update active state in DOM
            document.querySelectorAll('.text-element-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelectorAll('.text-box').forEach(box => {
                box.classList.remove('active');
            });
            
            const listItem = document.querySelector(`.text-element-item[data-id="${id}"]`);
            const textBox = document.getElementById(`visual_${id}`);
            
            if (listItem && textBox) {
                listItem.classList.add('active');
                textBox.classList.add('active');
                
                // Update active text element
                activeTextElement = textElements.find(te => te.id === id);
                
                // Update controls to match active element
                if (activeTextElement) {
                    document.getElementById('textContent').value = activeTextElement.text;
                    document.getElementById('textSize').value = activeTextElement.size;
                    document.getElementById('textSizeValue').textContent = activeTextElement.size + 'px';
                    document.getElementById('strokeWidth').value = activeTextElement.strokeWidth;
                    document.getElementById('strokeWidthValue').textContent = activeTextElement.strokeWidth + 'px';
                    document.getElementById('textColor').value = activeTextElement.color;
                    document.getElementById('strokeColor').value = activeTextElement.strokeColor;
                    document.getElementById('fontFamily').value = activeTextElement.font;
                    document.getElementById('textAlign').value = activeTextElement.align;
                }
            }
        }

        // Update text element
        function updateTextElement(id) {
            const textElement = textElements.find(te => te.id === id);
            const textBox = document.getElementById(`visual_${id}`);
            const listItem = document.querySelector(`.text-element-item[data-id="${id}"] .text-element-preview`);
            
            if (textElement && textBox && listItem) {
                textBox.textContent = textElement.text;
                listItem.textContent = textElement.text;
                updateTextBoxStyle(textBox, textElement);
            }
        }

        // Edit text element
        function editTextElement(id) {
            const textElement = textElements.find(te => te.id === id);
            if (textElement) {
                const newText = prompt('Edit text:', textElement.text);
                if (newText !== null) {
                    textElement.text = newText;
                    updateTextElement(id);
                    drawMeme();
                }
            }
        }

        // Delete text element
        function deleteTextElement(id) {
            if (confirm('Are you sure you want to delete this text?')) {
                textElements = textElements.filter(te => te.id !== id);
                
                // Remove from DOM
                const textBox = document.getElementById(`visual_${id}`);
                const listItem = document.querySelector(`.text-element-item[data-id="${id}"]`);
                
                if (textBox) textBox.remove();
                if (listItem) listItem.remove();
                
                // Reset active element
                if (activeTextElement && activeTextElement.id === id) {
                    activeTextElement = null;
                }
                
                drawMeme();
            }
        }

        // Draw meme on canvas
        function drawMeme() {
            if (!currentImage || !currentImage.complete) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw the image
            ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
            
            // Draw text elements
            textElements.forEach(textElement => {
                ctx.font = `bold ${textElement.size}px ${textElement.font}`;
                ctx.fillStyle = textElement.color;
                ctx.strokeStyle = textElement.strokeColor;
                ctx.lineWidth = textElement.strokeWidth;
                ctx.textAlign = textElement.align;
                ctx.textBaseline = 'middle';
                
                const x = (textElement.x / 100) * canvas.width;
                const y = (textElement.y / 100) * canvas.height;
                
                // Draw stroke
                if (textElement.strokeWidth > 0) {
                    ctx.strokeText(textElement.text.toUpperCase(), x, y);
                }
                
                // Draw fill
                ctx.fillText(textElement.text.toUpperCase(), x, y);
            });
        }

        // Add user template
        function addUserTemplate() {
            const fileInput = document.getElementById('uploadTemplate');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select an image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const name = file.name.split('.')[0] || 'Custom Template';
                const newTemplate = {
                    name: name,
                    url: e.target.result
                };
                
                userTemplates.push(newTemplate);
                localStorage.setItem('userTemplates', JSON.stringify(userTemplates));
                
                // Load the new template
                loadImage(newTemplate.url);
                
                fileInput.value = '';
                alert('Template added successfully!');
            };
            reader.readAsDataURL(file);
        }

        // Download meme
        function downloadMeme() {
            if (!currentImage || !currentImage.complete) {
                alert('Please wait for the image to load');
                return;
            }
            
            // Create a temporary canvas for high-quality download
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            
            // Use original image dimensions for better quality
            tempCanvas.width = currentImage.width;
            tempCanvas.height = currentImage.height;
            
            // Draw the image at original size
            tempCtx.drawImage(currentImage, 0, 0, tempCanvas.width, tempCanvas.height);
            
            // Draw text elements with scaled positions
            textElements.forEach(textElement => {
                // Scale text size for high quality
                const scaledSize = (textElement.size * tempCanvas.width) / canvas.width;
                
                tempCtx.font = `bold ${scaledSize}px ${textElement.font}`;
                tempCtx.fillStyle = textElement.color;
                tempCtx.strokeStyle = textElement.strokeColor;
                tempCtx.lineWidth = (textElement.strokeWidth * tempCanvas.width) / canvas.width;
                tempCtx.textAlign = textElement.align;
                tempCtx.textBaseline = 'middle';
                
                const x = (textElement.x / 100) * tempCanvas.width;
                const y = (textElement.y / 100) * tempCanvas.height;
                
                // Draw stroke
                if (textElement.strokeWidth > 0) {
                    tempCtx.strokeText(textElement.text.toUpperCase(), x, y);
                }
                
                // Draw fill
                tempCtx.fillText(textElement.text.toUpperCase(), x, y);
            });
            
            // Create download link
            const link = document.createElement('a');
            link.download = 'meme.png';
            link.href = tempCanvas.toDataURL('image/png');
            link.click();
        }

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
